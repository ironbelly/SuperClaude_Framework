# Tasklist: M2.5 - Quality Remediation Phase

## Metadata
- **Milestone**: M2.5
- **Dependencies**: M2
- **Estimated Complexity**: Medium
- **Primary Persona**: Refactorer
- **Deliverables**: 4

---

## Context: Quality Analysis Results

This milestone addresses verified issues identified through adversarial debate analysis of M1-M2 implementation.

### Quality Score: 68/100 → Target: 85/100

### Issues Analyzed: 10
- **Dismissed**: 6 (ISS-001, ISS-005, ISS-006, ISS-007, ISS-008, ISS-010)
- **Verified**: 4 (ISS-002, ISS-003, ISS-004, ISS-009)

### Issue Summary

| Issue | Severity | Problem | Approved Solution |
|-------|----------|---------|-------------------|
| ISS-002 | MEDIUM | Missing Wave 0 prerequisite check | SOL-002-A: Explicit Wave 0 Section |
| ISS-003 | HIGH | Missing inline template generation algorithm | SOL-003-B: Summary with Spec Reference |
| ISS-004 | MEDIUM | Missing TodoWrite blocked workaround | SOL-004-B: Reference Card Table |
| ISS-009 | LOW | Template discovery lacks detail | SOL-009-A: Expand Existing Section |

---

## Tasks

### T2.5.1: Add Wave 0 Prerequisites Section
**Type**: IMPROVEMENT
**Priority**: P1-High
**Issue**: ISS-002
**Files Affected**:
- `.claude/skills/sc-roadmap/SKILL.md`

#### Context
Spec Section 6.4 mandates a "Wave 0 (Prerequisites)" step that checks template directory existence before main workflow. Current implementation merges this into Wave 2 without explicit visibility.

#### Approved Solution: SOL-002-A
Add a dedicated 'Wave 0: Prerequisites' section before Wave 1 that:
1. Checks template directory existence using file system operations
2. Validates write permissions to output directory
3. Logs warning if template fallback is needed
4. Follows existing wave pattern structure

#### Steps
1. Insert new section between "## Behavioral Flow" header and "### Wave 1"
2. Add Wave 0 header with purpose description
3. Add prerequisite steps in YAML format:
   - Template directory check
   - Output directory validation
   - Permission verification
   - Fallback logging
4. Include entry/exit criteria

#### Acceptance Criteria
- [ ] Wave 0 section exists before Wave 1
- [ ] Template directory check documented
- [ ] Output directory validation documented
- [ ] Warning logging for fallback case documented
- [ ] Follows existing wave YAML structure

#### Verification
```bash
grep -A 20 "### Wave 0" .claude/skills/sc-roadmap/SKILL.md
# Should show prerequisites section with template check
```

#### Estimated Lines: ~50

---

### T2.5.2: Add Inline Template Generation Algorithm
**Type**: IMPROVEMENT
**Priority**: P0-Critical
**Issue**: ISS-003
**Files Affected**:
- `.claude/skills/sc-roadmap/SKILL.md`

#### Context
Spec Section 3.3.1 defines a complete inline template generation algorithm for when no matching template is found. This is a critical fallback path that affects all roadmap generation when templates are missing.

#### Approved Solution: SOL-003-B
Add condensed algorithmic summary with spec reference:
1. Include essential decision logic inline
2. Provide milestone count thresholds
3. Document domain mapping rules
4. Reference spec Section 3.3.1 for edge cases
5. Version-anchor the reference

#### Steps
1. Add new section "#### Inline Template Generation Fallback" after Wave 2 overview
2. Include milestone count formula as decision table:
   - complexity_low (<0.4): 3-4 milestones
   - complexity_medium (0.4-0.7): 4-6 milestones
   - complexity_high (>0.7): 5-8 milestones
3. Include domain milestone mapping:
   - frontend_primary → "UX Validation"
   - backend_primary → "API Specification"
   - security_primary → "Security Audit"
4. Document required sections per milestone
5. Add spec reference with version: "See SC-ROADMAP-FEATURE-SPEC.md v1.1.0 Section 3.3.1"

#### Acceptance Criteria
- [ ] Milestone count thresholds documented inline
- [ ] Domain milestone mappings included
- [ ] Count selection formula present
- [ ] Required sections per milestone listed
- [ ] Spec version-anchored reference included
- [ ] Edge cases reference spec (not duplicated)

#### Verification
```bash
grep -c "milestone_count\|domain_mapping\|Section 3.3.1" .claude/skills/sc-roadmap/SKILL.md
# Should return >= 3
```

#### Estimated Lines: ~55

---

### T2.5.3: Add TodoWrite Blocked State Reference Card
**Type**: DOC
**Priority**: P1-High
**Issue**: ISS-004
**Files Affected**:
- `.claude/skills/sc-roadmap/SKILL.md`

#### Context
TodoWrite only supports 3 states (pending, in_progress, completed). Blocked tasks require a workaround pattern using content prefixes. This is undocumented in SKILL.md.

#### Approved Solution: SOL-004-B
Add consolidated reference card table with:
1. All official TodoWrite states
2. The [BLOCKED: reason] prefix pattern
3. State transition rules
4. Anti-patterns to avoid

#### Steps
1. Add new section "### TodoWrite State Reference" after MCP Integration
2. Create state table with columns: State | Meaning | Usage
3. Add blocked workaround section with example
4. Add anti-patterns section showing what NOT to do
5. Include practical code example

#### Content Template
```markdown
### TodoWrite State Reference

| State | Meaning | Usage |
|-------|---------|-------|
| `pending` | Ready for execution | Initial state for new tasks |
| `in_progress` | Currently active | Only ONE task should be in_progress at a time |
| `completed` | Successfully finished | Mark when task is done |

#### Blocked Task Workaround
Since TodoWrite does not support a "blocked" state, use the content prefix pattern:

```yaml
# CORRECT - Use pending with prefix
- content: "[BLOCKED: waiting for API docs] Implement authentication"
  status: pending
  activeForm: "Implementing authentication (blocked on API docs)"
```

#### Anti-Patterns (Avoid)
```yaml
# WRONG - Will fail
status: blocked  # Not a valid state!
```
```

#### Acceptance Criteria
- [ ] State reference table with 3 states
- [ ] Blocked workaround pattern documented
- [ ] Code example included
- [ ] Anti-pattern example included
- [ ] Placed after MCP Integration section

#### Verification
```bash
grep -A 5 "BLOCKED:" .claude/skills/sc-roadmap/SKILL.md
# Should show the workaround pattern
```

#### Estimated Lines: ~35

---

### T2.5.4: Expand Template Discovery Section
**Type**: DOC
**Priority**: P2-Medium
**Issue**: ISS-009
**Files Affected**:
- `.claude/skills/sc-roadmap/SKILL.md`

#### Context
Wave 2 mentions "Template discovery: local → user → plugin → inline" but lacks explicit glob patterns and version resolution logic.

#### Approved Solution: SOL-009-A
Expand existing Wave 2 section with:
1. Explicit glob patterns for each search location
2. Version resolution rules
3. Fallback conditions

#### Steps
1. Locate Wave 2 section in SKILL.md
2. Add template discovery detail after template mention
3. Include search path table with glob patterns
4. Add version resolution rules

#### Content Template
```yaml
template_discovery:
  search_order:
    - path: "./templates/roadmaps/"
      glob: "*.md"
      priority: 1 (local project templates)

    - path: "~/.claude/templates/roadmaps/"
      glob: "{type}-*.md"
      priority: 2 (user templates)

    - path: "plugins/superclaude/templates/roadmaps/"
      glob: "*.md"
      priority: 3 (plugin templates)

    - path: "inline"
      condition: "No matching template found"
      priority: 4 (generated variant)

  version_resolution:
    - prefer: "Exact version match if --template-version specified"
    - fallback: "Latest version by semantic versioning"
    - default: "First matching template in priority order"

  matching_criteria:
    - frontmatter.applicable contains spec domain
    - frontmatter.template matches --template flag if provided
```

#### Acceptance Criteria
- [ ] Search paths with glob patterns documented
- [ ] Version resolution rules included
- [ ] Fallback conditions clear
- [ ] Placed within Wave 2 section

#### Verification
```bash
grep -c "glob\|version_resolution\|search_order" .claude/skills/sc-roadmap/SKILL.md
# Should return >= 2
```

#### Estimated Lines: ~40

---

## Milestone Completion Checklist

- [ ] T2.5.1: Wave 0 Prerequisites section added
- [ ] T2.5.2: Inline template algorithm documented
- [ ] T2.5.3: TodoWrite reference card added
- [ ] T2.5.4: Template discovery expanded

## Dependencies
- M2 must be complete (Wave 1 implementation exists)
- T2.5.1 can execute independently
- T2.5.2 can execute independently
- T2.5.3 can execute independently
- T2.5.4 can execute independently
- All tasks can execute in parallel

## Quality Gate
After completing all tasks, re-run quality analysis:
- Target score: ≥85/100
- All HIGH severity issues must be resolved

---

## Adversarial Debate Summary

### Issues Dismissed (Not Actual Issues)
| Issue | Reason for Dismissal |
|-------|---------------------|
| ISS-001 | Codebase convention uses hyphens in frontmatter, not colons |
| ISS-005 | Task numbering follows T{milestone}.{seq} convention correctly |
| ISS-006 | Waves 2-5 have detailed implementation in separate tasklist files |
| ISS-007 | Section 3.7 applies to sc:roadmap skill, not reviewed files |
| ISS-008 | ID schema is for roadmap artifacts, not SKILL.md |
| ISS-010 | "capability" is a valid extension of template example |

### Solutions Selected via Adversarial Debate
| Issue | Solutions Debated | Winner | Rationale |
|-------|-------------------|--------|-----------|
| ISS-002 | A: Explicit Wave 0 vs B: Integrated T0 | **A** | Spec explicitly uses "Wave 0" terminology with MUST language |
| ISS-003 | A: Full Algorithm vs B: Summary + Ref | **B** | DRY principle, single source of truth, reduced maintenance |
| ISS-004 | A: Dedicated Section vs B: Reference Card | **B** | Better usability with visual table format |
| ISS-009 | A: Expand Section vs B: Full Subsection | **A** | Proportional response for LOW severity issue |

---

*Tasklist generated by SuperClaude Quality Remediation Process*
*Based on adversarial debate analysis of M1-M2 implementation*
*Date: 2026-01-27*
